<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="/template.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:sf="http://xmlns.jcp.org/jsf/composite/sfcomp">

    <h:form>
        <sf:crudToolbar crudBean="#{produtoBean}">
            <p:button value="Relatório"></p:button>
        </sf:crudToolbar>
        <h:panelGrid columns="2" rendered="#{produtoBean.estado != 'PESQUISANDO'}">
            <p:outputLabel value="Nome" for="inputNome"></p:outputLabel>
            <p:inputText id="inputNome" value="#{produtoBean.entity.nome}"></p:inputText>

            <p:outputLabel value="Descrição" for="inputdesc"></p:outputLabel>
            <p:inputText id="inputdesc" value="#{produtoBean.entity.descricao}" ></p:inputText>

            <p:outputLabel value="Data Fabricação" for="inputData"></p:outputLabel>
            <p:datePicker  monthNavigator="true" yearNavigator="true" showWeek="true" value="#{produtoBean.entity.dataFabricacao}" id="inputData"></p:datePicker>

            <p:outputLabel value="Marca" for="@next"/>
            <p:autoComplete id="pojo" value="#{marca}"
                            completeMethod="#{marcaBean.logic.listar()}"
                            var="marca" itemLabel="#{marca.nome}" itemValue="#{marca}"
                            converter="marcaConverter" forceSelection="true" scrollHeight="250"/>

            <p:outputLabel value="Valor" for="inputvalor"></p:outputLabel>
            <p:inputText id="inputvalor" value="#{produtoBean.entity.valor}"></p:inputText>

            <h:outputLabel for="txt2" value="Fornecedor: "/>
            <p:selectOneMenu id="txt2" value="#{produtoBean.entity.fornecedor}" required="false" label="Text 2" style="width: 12rem" converter="fornecedorConverter">
                <f:selectItem itemLabel="Selecione" itemValue="" noSelectionOption="true" />
                <f:selectItems value="#{fornecedorBean.logic.listar()}" var="fornecedor" itemLabel="#{fornecedor.nome}"  itemValue="#{fornecedorBean.entity}"  />
            </p:selectOneMenu>
            <p:message for="@previous"/>
            <h:outputText value="#{searchView.text2}"/>

            <p:growl id="messages" showDetail="true"/>

            <p:fileUpload mode="advanced"
                          multiple="false"
                          sizeLimit="102400" allowTypes="/(\.|\/)(gif|jpe?g|png)$/"
                          invalidSizeMessage="Maximum file size allowed is 100 KB"
                          invalidFileMessage="only gif | jpg | jpeg | png is allowed"
                          update="messages cropperPanel"
                          listener="#{cropUploaderBean.handleFileUpload}"/>

            <p:outputPanel id="cropperPanel">

                <h:panelGrid columns="1" rendered="#{not empty cropUploaderBean.originalImageFile}">

                    <p:commandButton value="Crop"
                                     action="#{cropUploaderBean.crop}"
                                     update="cropped messages" styleClass="my-3"/>

                    <h:panelGrid columns="2" cellpadding="7">
                        <!--cropUploaderBean.croppedImage  -->
                        <p:imageCropper
                            value="#{produtoBean.entity.fotoBanco}" 
                            id="imageCropper" cache="false"
                            image="#{cropUploaderBean.image}"
                            initialCoords="50,50,150,100"
                            minSize="50,50" maxSize="350,350"/>

                        <p:outputPanel id="cropped">
                            <p:graphicImage cache="false"
                                            rendered="#{not empty cropUploaderBean.croppedImage}"
                                            value="#{cropUploaderBean.cropped}"/>
                        </p:outputPanel>

                    </h:panelGrid>


                </h:panelGrid>
            </p:outputPanel>
        </h:panelGrid>
        <p:dataTable value="#{produtoBean.entitys}" var="entity" rendered="#{produtoBean.estado == 'PESQUISANDO'}">
            <p:column>
                <p:commandButton icon="fa-solid fa-trash" update="@form"
                                 actionListener="#{produtoBean.remover(entity)}"
                                 ></p:commandButton>
                <p:commandButton icon="fa-solid fa-pencil" update="@form"
                                 actionListener="#{produtoBean.editar(entity)}"
                                 ></p:commandButton>
            </p:column>
            <p:column headerText="Nome">
                <h:outputText value="#{entity.nome}"></h:outputText>
            </p:column>
            <p:column headerText="Descrição">
                <h:outputText value="#{entity.descricao}"></h:outputText>
            </p:column>
            <p:column headerText="Valor">
                <h:outputText value="#{entity.valor}"></h:outputText>
            </p:column>
            <p:column headerText="Data Fabricação">
                <h:outputText value="#{entity.dataFabricacao}"></h:outputText>
            </p:column>
        </p:dataTable>


    </h:form>

</ui:composition>
